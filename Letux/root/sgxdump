#!/bin/bash
echo "*** SGX Register Dump ***"
cat /proc/cpuinfo | fgrep Hardware

function registers {
if fgrep -q AM33XX </proc/cpuinfo
then
cat <<AM33XX
44E00900	CM_GFX_L3_CLKSTCTRL
44E00904	CM_GFX_GFX_CLKCTRL
44E0090c	CM_GFX_L4LS_GFX_CLKSTCTR
44E00910	CM_GFX_MMUCFG_CLKCTRL
44E00914	CM_GFX_MMUDATA_CLKCTRL
44E0052c	CM_DPLL.CLKSEL_GFX_FCLK
44E01100	PM_GFX_PWRSTCTRL
44E01104	RM_GFX_RSTCTRL
44E01110	PM_GFX_PWRSTST
AM33XX
# the following regs do not exists as expected
#5600fe00	OCP_REVISION
#5600fe04	OCP_HWINFO
#5600fe10	OCP_SYSCONFIG
#5600fe24	OCP_IRQSTATUS_RA_0
#5600fe28	OCP_IRQSTATUS_RA_1
#5600fe2c	OCP_IRQSTATUS_RA_2
#5600fe30	OCP_IRQSTATUS_0
#5600fe34	OCP_IRQSTATUS_1
#5600fe38	OCP_IRQSTATUS_2
#5600fe3c	OCP_IRQENABLE_SET_0
#5600fe40	OCP_IRQENABLE_SET_1
#5600fe44	OCP_IRQENABLE_SET_2
#5600fe48	OCP_IRQENABLE_CLR_0
#5600fe4c	OCP_IRQENABLE_CLR_1
#5600fe50	OCP_IRQENABLE_CLR_2
#5600ff00	OCP_PAGE_CONFIG
#5600ff04	OCP_INTERRUPT_EVENT
#5600ff08	OCP_DEBUG_CONFIG
#5600ff0c	OCP_DEBUG_STATUS
#AM33XX
else
cat <<OMAP3
48004B00	CM_FCLKEN_SGX
48004B10	CM_ICLKEN_SGX
48004B20	CM_IDLEST_SGX
48004B40	CM_CLKSEL_SGX
48004B44	CM_SLEEPDEP_SGX
48004B48	CM_CLKSTCTRL_SGX
48004b4c	CM_CLKSTST_SGX
48306b58	RM_RSTST_SGX
48306bc8	PM_WKDEP_SGX
48306be0	PM_PWSTCTRL_SGX
48306be4	PM_PWSTST_SGX
48306be8	PM_PREPWSTST_SGX
5000fe00	OCP_REVISION
5000fe04	OCP_HWINFO
5000fe10	OCP_SYSCONFIG
5000fe24	OCP_IRQSTATUS_RA_0
5000fe28	OCP_IRQSTATUS_RA_1
5000fe2c	OCP_IRQSTATUS_RA_2
5000fe30	OCP_IRQSTATUS_0
5000fe34	OCP_IRQSTATUS_1
5000fe38	OCP_IRQSTATUS_2
5000fe3c	OCP_IRQENABLE_SET_0
5000fe40	OCP_IRQENABLE_SET_1
5000fe44	OCP_IRQENABLE_SET_2
5000fe48	OCP_IRQENABLE_CLR_0
5000fe4c	OCP_IRQENABLE_CLR_1
5000fe50	OCP_IRQENABLE_CLR_2
5000ff00	OCP_PAGE_CONFIG
5000ff04	OCP_INTERRUPT_EVENT
5000ff08	OCP_DEBUG_CONFIG
5000ff0c	OCP_DEBUG_STATUS
OMAP3
fi
}

registers | while read ADDR REGISTER COMMENT
do
	ADDR=0x$ADDR
	VAL=$(devmem2 $ADDR w | fgrep 'Value at address' | cut -d ' ' -f 6)
	VAL=$(printf %08x $[$VAL])
	echo $ADDR $VAL $REGISTER $COMMENT
done

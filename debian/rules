#!/usr/bin/make -f

CONFIG = omap2plus_defconfig
ARCH   = arm

ifneq (,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))
	NUMJOBS = $(patsubst parallel=%,%,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))
	BUILD_FLAGS += -j$(NUMJOBS)
endif

ifneq ($(DEB_BUILD_GNU_TYPE),$(DEB_TARGET_MULTIARCH))
	BUILD_FLAGS += CROSS_COMPILE=$(DEB_TARGET_MULTIARCH)-
endif

build-arch:
	$(MAKE) ARCH=$(ARCH) $(CONFIG)
	$(MAKE) ARCH=$(ARCH) $(BUILD_FLAGS) zImage modules dtbs

binary-arch:
ifeq ($(DEB_BUILD_GNU_TYPE),$(DEB_TARGET_MULTIARCH))
	$(MAKE) ARCH=$(ARCH) $(BUILD_FLAGS) intdeb-pkg
else
	$(MAKE) ARCH=$(ARCH) $(BUILD_FLAGS) HOSTCC=$(DEB_TARGET_MULTIARCH)-gcc modules
	$(MAKE) ARCH=$(ARCH) $(BUILD_FLAGS) \
		HOSTCC=$(DEB_TARGET_MULTIARCH)-gcc intdeb-pkg
endif

clean:
	rm -rf debian/*tmp debian/files debian/linux-headers \
		debian/linux-image debian/linux-image-dbg
	$(MAKE) ARCH=$(ARCH) $(BUILD_FLAGS) mrproper

build:  build-arch
binary: binary-arch
